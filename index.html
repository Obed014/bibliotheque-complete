<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bibliothèque</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;1,9..144,300&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
/* ══ THEMES & STYLE ══════════════════════════════════ */
:root,[data-theme="light"]{--bg:#f7f8fa;--bg2:#ffffff;--bg3:#f1f3f6;--surf:rgba(0,0,0,.03);--surf2:rgba(0,0,0,.055);--border:rgba(0,0,0,.09);--border2:rgba(0,0,0,.14);--accent:#2563eb;--accent2:#1d4ed8;--accent-t:rgba(37,99,235,.1);--accent-t2:rgba(37,99,235,.18);--red:#dc2626;--green:#16a34a;--orange:#ea580c;--purple:#7c3aed;--blue:#2563eb;--text:#111827;--text2:#4b5563;--text3:#9ca3af;--shadow:0 1px 4px rgba(0,0,0,.08),0 4px 16px rgba(0,0,0,.06);--shadow-lg:0 8px 32px rgba(0,0,0,.12);--r:12px;--rs:8px;--sb-bg:#111827;--sb-text:rgba(255,255,255,.75);--sb-text2:rgba(255,255,255,.45);--sb-border:rgba(255,255,255,.08);--sb-active-bg:rgba(255,255,255,.1);--sb-active:rgba(255,255,255,.95);--sb-accent:#60a5fa}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}.shell{display:flex;min-height:100vh}.sidebar{width:252px;background:var(--sb-bg);position:fixed;height:100vh;z-index:100;color:#fff;padding:20px}.main{flex:1;margin-left:252px;padding:30px}.btn{padding:9px 18px;border-radius:var(--rs);border:none;cursor:pointer;font-weight:600}.btn-primary{background:var(--accent);color:#fff}.ov{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.mc{background:var(--bg2);padding:30px;border-radius:18px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto}.fac{display:flex;gap:10px;margin-top:20px}.zlist{border:1px solid var(--border);margin:15px 0;max-height:200px;overflow-y:auto}.zrow{padding:10px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}.zrow.sel{background:var(--accent-t)}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

// Composant Icon simple
const Icon = ({ name, size=16 }) => <span style={{fontSize:size}}>•</span>;

const App = () => {
  const [modal, setModal] = useState('zotero'); // Par défaut pour le test
  const [zp, setZp] = useState([]);
  const [zst, setZst] = useState('');
  const zRef = useRef(null);
  const CATS = ["Roman", "Essai", "BD", "Technique"];

  const close = () => setModal(null);
  const handleZFile = () => { setZst('Fichier simulé chargé'); setZp([{title: "Livre Test", author: "Auteur", year: "2024", _s: true, category: "Roman"}]); };
  const doZotero = () => { alert("Importation réussie"); close(); };

  return (
    <div className="shell">
      <div className="sidebar">
        <h2>Bibliothèque</h2>
        <button className="btn btn-primary" onClick={() => setModal('zotero')}>Importer Zotero</button>
      </div>

      <main className="main">
        <h1>Mon Catalogue</h1>
        <p>Le contenu s'affiche désormais correctement.</p>
      </main>

      {/* MODALE ZOTERO CORRIGÉE */}
      {modal === 'zotero' && (
        <div className="ov" onClick={() => { close(); setZp([]); setZst(''); }}>
          <div className="mc" onClick={e => e.stopPropagation()}>
            <div className="mh">
              <h2>Importer depuis Zotero</h2>
            </div>
            
            <input ref={zRef} type="file" style={{display:'none'}} onChange={handleZFile}/>
            <div style={{padding:20, border:'2px dashed #ccc', textAlign:'center', cursor:'pointer'}} onClick={() => zRef.current.click()}>
              Cliquez pour choisir un fichier (.bib, .ris, .csv)
            </div>

            {zst && <div style={{margin:'10px 0', color:'green'}}>{zst}</div>}

            {zp.length > 0 && (
              <React.Fragment>
                <div className="zlist">
                  {zp.map((bk, i) => (
                    <div key={i} className={`zrow ${bk._s ? 'sel' : ''}`}>
                      <input type="checkbox" checked={bk._s} onChange={() => {}} />
                      <div style={{flex:1}}>
                        <strong>{bk.title}</strong>
                        <div>{bk.author} - {bk.year}</div>
                      </div>
                    </div>
                  ))}
                </div>
                <div className="fac">
                  <button className="btn btn-primary" style={{flex:1}} onClick={doZotero}>
                    Importer {zp.filter(b => b._s).length} livre(s)
                  </button>
                  <button className="btn" onClick={() => { setZp([]); setZst(''); close(); }}>
                    Annuler
                  </button>
                </div>
              </React.Fragment>
            )}
          </div>
        </div>
      )}
    </div>
  );
};

// RENDU FINAL
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
